apply plugin:'java'
apply plugin:'groovy'
apply plugin:'maven'

version = '0.0.1-SNAPSHOT'

configurations {
	deployerJars
	mirah
}

if(!System.getenv().get('GRADLE_HOME')) throw new Exception('Please set $GRADLE_HOME')

repositories {
	mavenLocal()
  mavenCentral()
  mavenRepo urls:'http://repo.smokejumperit.com'
}
dependencies {
  groovy 'org.codehaus.groovy:groovy:1.8.0-rc-3'
  deployerJars "org.apache.maven.wagon:wagon-ssh:1.0-beta-6" 
  compile fileTree(
    dir:System.getenv().get('GRADLE_HOME'),
    includes:['**/*.jar']
  )
  mirah fileTree(
    dir:new File(project.projectDir, "lib"),
    includes:['**/mirah*.jar']
	)
}
configurations.compile.extendsFrom(configurations.mirah)

jar {
	dependsOn configurations.mirah
	from { configurations.mirah.collect { it.isDirectory() ? it : zipTree(it) } }
}

uploadArchives { 
  repositories.mavenDeployer {
    def repoUser = System.properties['sjit.repo.user']
    configuration = configurations.deployerJars
    repository(url: "scp://repo.smokejumperit.com/home/$repoUser/repo.smokejumperit.com/") {
      authentication(
        userName: repoUser,
        privateKey: System.properties['sjit.repo.keyFile'],
        passphrase: System.properties['sjit.repo.passphrase']
      )
      pom {
        groupId='com.smokejumperit.gradle'
        artifactId='compiler-plugins'
        version= project.version
      }
    }
  } 
} 
